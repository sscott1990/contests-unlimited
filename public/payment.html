<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Enter Contest</title>
  <link rel="stylesheet" href="/styles.css">
  <style>
     button#checkout_button {
      display: inline-block;
      font-family: sans-serif;
      font-size: 20px;
      background-color: #0BD992;
      color: white;
      border-radius: 4px;
      padding: 14px 28px;
      margin-top: 20px;
      cursor: pointer;
    }
     button#checkout_button:hover {
      background-color: #0AC982;
    }

     button#checkout_button:disabled {
      background-color: #ccc;
      cursor: not-allowed;
    }

  </style>
</head>
<body>
  <h1>Enter Contest - $100 Entry</h1>

  <p style="margin-top: 20px; font-size: 0.95em; color: #444;">
    üèÜ Winners will be contacted via email and asked to provide their full name and mailing address to issue the prize check.<br/>
    <strong>Each contest is seeded (see contest details for exact seed and minimum). The seed is removed if the minimum is not met by contest end.</strong><br/>
    <strong>$100 entry fee: 60% to prize pot, 25% to contest creator for each entry up to the minimum, 30% for every entry above the minimum, 10% reserve, 5% to platform (custom contests).</strong>
  </p>

  <!-- Judging Criteria Section -->
  <div style="margin-top: 40px; margin-bottom: 30px; background: #f5f9f7; border-left: 5px solid #0BD992; border-radius: 8px; padding: 18px 22px; max-width: 750px; margin-left: auto; margin-right: auto;">
    <h2>Judging Criteria</h2>
    <ul style="font-size:1.07em; color:#222;">
      <li><b>Art Contest:</b> Creativity and originality, artistic technique and skill, adherence to theme or prompt, overall impression.</li>
      <li><b>Photo Contest:</b> Creativity and originality, technical quality (focus, lighting, composition), relevance to theme or prompt, overall impact.</li>
      <li><b>Caption Contest:</b> Creativity, wit, or humor; relevance to the image or prompt; clarity and conciseness.</li>
      <li><b>Trivia Contest:</b> Number of correct answers, speed of response. Top scorer or fastest correct responder wins; no random selection.</li>
    </ul>
    <div style="color:#555; font-size:0.96em; margin-top:8px;">All judging is performed solely by the contest administrator, based on these published criteria. The administrator‚Äôs decisions are final.</div>
  </div>

<label for="state">Select Your Home State: <span style="font-size: 0.85em; color: #666;">(Contests may be restricted in some areas)</span></label>
    <select name="state" id="state" required>
      <option value="">-- Select a State --</option>
      <option value="AL">Alabama</option>
      <option value="AK">Alaska</option>
      <option value="AZ">Arizona</option>
      <option value="AR">Arkansas</option>
      <option value="CA">California</option>
      <option value="CO">Colorado</option>
      <option value="CT">Connecticut</option>
      <option value="DE">Delaware</option>
      <option value="FL">Florida</option>
      <option value="GA">Georgia</option>
      <option value="HI">Hawaii</option>
      <option value="ID">Idaho</option>
      <option value="IL">Illinois</option>
      <option value="IN">Indiana</option>
      <option value="IA">Iowa</option>
      <option value="KS">Kansas</option>
      <option value="KY">Kentucky</option>
      <option value="LA">Louisiana</option>
      <option value="ME">Maine</option>
      <option value="MD">Maryland</option>
      <option value="MA">Massachusetts</option>
      <option value="MI">Michigan</option>
      <option value="MN">Minnesota</option>
      <option value="MS">Mississippi</option>
      <option value="MO">Missouri</option>
      <option value="MT">Montana</option>
      <option value="NE">Nebraska</option>
      <option value="NV">Nevada</option>
      <option value="NH">New Hampshire</option>
      <option value="NJ">New Jersey</option>
      <option value="NM">New Mexico</option>
      <option value="NY">New York</option>
      <option value="NC">North Carolina</option>
      <option value="ND">North Dakota</option>
      <option value="OH">Ohio</option>
      <option value="OK">Oklahoma</option>
      <option value="OR">Oregon</option>
      <option value="PA">Pennsylvania</option>
      <option value="RI">Rhode Island</option>
      <option value="SC">South Carolina</option>
      <option value="SD">South Dakota</option>
      <option value="TN">Tennessee</option>
      <option value="TX">Texas</option>
      <option value="UT">Utah</option>
      <option value="VT">Vermont</option>
      <option value="VA">Virginia</option>
      <option value="WA">Washington</option>
      <option value="WV">West Virginia</option>
      <option value="WI">Wisconsin</option>
      <option value="WY">Wyoming</option>
      <option value="DC">District of Columbia</option>
      <option value="AS">American Samoa</option>
      <option value="GU">Guam</option>
      <option value="MP">Northern Mariana Islands</option>
      <option value="PR">Puerto Rico</option>
      <option value="VI">U.S. Virgin Islands</option>
      <option value="UM">U.S. Minor Outlying Islands</option>
      <option value="FM">Federated States of Micronesia</option>
      <option value="MH">Marshall Islands</option>
      <option value="PW">Palau</option>
</select>

<div id="stateAlert" class="alert" style="display: none;">Contests for cash are not available in your state.</div>

<div style="margin-top: 15px;">
  <input type="checkbox" id="ageConfirm" required>
  <label for="ageConfirm" style="font-size: 0.85em; color: #555;">
    I confirm that I am 18 years of age or older.
  </label>
</div>

  <button id="checkout_button" disabled>Check Out</button>

<p style="font-size: 0.85em; color: #555; margin-top: 10px;">
  By submitting, you agree to our <a href="#terms" style="color: #0BD992; text-decoration: underline;">Terms and Conditions</a>.
</p>

<div style="margin:28px 0 0 0; background:#f9f9ff; border-left:4px solid #005b96; border-radius:6px; padding:14px 18px;">
      <b>Eligibility, Payments & Tax Requirements:</b>
      <ul style="margin:10px 0 0 15px;">
        <li>Contest winners/entrants must be U.S. citizens, legal residents, or legal entities (such as businesses) with a valid U.S. tax identification number (SSN, TIN, or EIN).</li>
        <li>Before any winner or creator (contest host) payments totaling $600 or more in a calendar year can be issued, you must submit a completed IRS Form W-9. Failure to provide required tax documentation within 10 business days of notification will result in forfeiture of the prize, and a new winner will be selected in your place.</li>
        <li>All contest winner earnings are reported in accordance with IRS regulations.</li>
      </ul>
    </div>

<div id="terms" style="margin-top: 40px; padding: 20px; font-size: 0.85em; color: #555; max-width: 800px; margin-left: auto; margin-right: auto;">
              <h3>Terms and Conditions</h3>
              <ul>
                <li>Each contest entry costs <strong>$100.00 USD</strong>. The entry fee is non-refundable.</li>
                <li>Each contest is seeded according to its duration:<br>
                  1 month: $250 seed, 50 entries minimum<br>
                  3 months: $500 seed, 100 entries minimum<br>
                  6 months: $750 seed, 150 entries minimum<br>
                  1 year: $1000 seed, 200 entries minimum<br>
                </li>
                <li><strong>Even if the minimum for the seed is not met, the winner will always receive 60% of all entry fees collected for that contest.</strong></li>
                <li>For custom contests: 60% of each entry fee is added to the prize pot (always paid to winner), 25% goes to the contest creator for each entry up to the minimum, 30% for each entry above the minimum, 10% is put in reserve, and 5% goes to the platform.</li>
                <li>For platform-run contests: 60% of each entry fee is added to the prize pot (always paid to winner), 10% goes to reserve, and 30% goes to the platform.</li>
                <li>Each contest has a unique prize pool that grows with each valid entry and seed (if qualified).</li>
                <li>At the end of the contest, one winner will be selected and awarded the full prize pool amount.</li>
                <li>Winners will be notified and paid within 7‚Äì14 business days after verification.</li>
                <li>Only participants aged 18 and older are eligible to enter.</li>
                <li>Any attempt to manipulate or defraud the contest will result in disqualification.</li>
                <li>By entering, you agree to the official rules and the final decisions of the contest administrators.</li>
                <li><strong>Judging Criteria:</strong> Winners are selected based solely on skill, creativity, accuracy, or merit as outlined in the contest description. No element of chance is used to determine winners. Judging is performed according to clear and objective criteria by qualified judges or an impartial voting process.</li>
                <li>All entries will be judged solely by the contest administrator. The administrator‚Äôs decisions are final and based on the published judging criteria.</li>
              </ul>
              <h3>Refund Policy</h3>
              <p>All contest entry fees are <strong>non-refundable</strong>. Once payment is submitted, no refunds will be issued under any circumstances, including disqualification or withdrawal.</p>
              <h3>Privacy Policy</h3>
              <p>We collect participant information including names, email address, uploaded files, and contest answers solely for the purpose of operating and managing contest entries. All data is securely stored and not shared, sold, or disclosed to third parties. Files are stored in AWS S3 and processed only for contest verification and winner selection. We use this information to ensure contest fairness and compliance. By participating, you consent to this data usage.</p>
            </div>

  <!-- ‚úÖ EPD Checkout Script -->
  <script
    src="https://secure.easypaydirectgateway.com/token/CollectCheckout.js"
    data-checkout-key="checkout_public_2828BnDCyj2J74bs2Hr7FT5wFN37qg2S"
  ></script>

  <script>
  const restrictedStates = ['NY', 'WA', 'NJ', 'PR', 'GU', 'AS', 'VI', 'MP', 'RI', 'FL', 'AZ'];
  const stateSelect = document.getElementById('state');
  const submitButton = document.getElementById('checkout_button');
  const stateAlert = document.getElementById('stateAlert');
  const ageConfirm = document.getElementById('ageConfirm');

  function updateSubmitButton() {
    const selectedState = stateSelect.value;
    const isRestricted = restrictedStates.includes(selectedState);
    const allFieldsFilled = selectedState && !isRestricted && ageConfirm.checked;

    submitButton.disabled = !allFieldsFilled;
    stateAlert.style.display = isRestricted ? 'block' : 'none';

    // Move these here to fix the ReferenceError
    ageConfirm.disabled = isRestricted;
    if (isRestricted) {
      ageConfirm.checked = false;
    }
  }

  stateSelect.addEventListener('change', updateSubmitButton);
  ageConfirm.addEventListener('change', updateSubmitButton);

  updateSubmitButton(); // ‚úÖ Ensure button is properly initialized

  document.getElementById('checkout_button').addEventListener('click', async function () {
    try {
      const response = await fetch('/api/session');
      if (!response.ok) throw new Error('Failed to get session ID');
      const data = await response.json();
      const sessionId = data.sessionId;

      if (
        typeof CollectCheckout === 'undefined' ||
        typeof CollectCheckout.redirectToCheckout !== 'function'
      ) {
        alert('Checkout is not available right now. Please refresh and try again.');
        return;
      }

      CollectCheckout.redirectToCheckout({
        type: "sale",
        lineItems: [
          {
            lineItemType: "purchase",
            sku: "contest-entry-may2025",
            quantity: 1
          },
        ],
        successUrl: `https://contests-unlimited.onrender.com/success.html?session_id=${sessionId}`,
        cancelUrl: "https://contests-unlimited.onrender.com/cancel.html",
        receipt: {
          showReceipt: false,
          sendToCustomer: true,
        },
        collectShippingInfo: true,
        useKount: false,
        paymentMethods: [
          {
            type: "creditCard",
            use3DSecure: false,
          },
          {
            type: "check",
          },
        ],
        fields: [],
      }).then((error) => {
        if (error) {
          console.error("Checkout redirect error:", error);
        }
      });
    } catch (err) {
      console.error('Error fetching session ID:', err);
      alert('Failed to start checkout session. Please try again.');
    }
  });
</script>
</body>
</html>